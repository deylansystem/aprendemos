const letters = {
            
    a: [
        { word: "Ardilla", image: "ardilla.png", syllables: ["empieza por", "a"] },
        { word: "Ave", image: "ave.png", syllables: ["empieza por", "a"] },
        { word: "Avi√≥n", image: "avion.png", syllables: ["empieza por", "a"] },
        { word: "Aguila", image: "aguila.png", syllables: ["empieza por", "a"] }
    ],
    b: [
        { word: "Burro", image: "burro.png", syllables: ["empieza por", "b"] },
        { word: "Bater√≠a", image: "bateria.png", syllables: ["empieza por", "b"] },
        { word: "Ballena", image: "ballena.png", syllables: ["empieza por", "b"] },
        { word: "B√∫ho", image: "buho.png", syllables: ["empieza por", "b"] }
    ],
    c: [
        { word: "Casa", image: "casa.png", syllables: ["empieza por", "c"] },
        { word: "Cama", image: "cama.png", syllables: ["empieza por", "c"] },
        { word: "Caballo", image: "caballo.png", syllables: ["empieza por", "c"] },
        { word: "Cepillo", image: "cepillo.png", syllables: ["empieza por", "c"] }
    ],
    d: [
        { word: "Dado", image: "dado.png", syllables: ["empieza por", "d"] },
        { word: "Dedo", image: "dedo.png", syllables: ["empieza por", "d"] },
        { word: "Delf√≠n", image: "delfin.png", syllables: ["empieza por", "d"] },
        { word: "Dardo", image: "dardo.png", syllables: ["empieza por", "d"] }

    ],
    e: [
        { word: "Elefante", image: "elefante.png", syllables: ["empieza por", "e"] },
        { word: "Erizo", image: "erizo.png", syllables: ["empieza por", "e"] },
        { word: "Estrella", image: "estrella.png", syllables: ["empieza por", "e"] },
        { word: "Excavadora", image: "excavadora.png", syllables: ["empieza por", "e"] }
    ],
    f: [
        { word: "Foca", image: "foca.png", syllables: ["empieza por", "f"] },
        { word: "Flamenco", image: "flamenco.png", syllables: ["empieza por", "f"] },
        { word: "Flor", image: "flor.png", syllables: ["empieza por", "f"] },
        { word: "Fresa", image: "fresa.png", syllables: ["empieza por", "f"] }
    ],
    g: [
        { word: "Gato", image: "gato.png", syllables: ["empieza por", "g"] },
        { word: "Gorila", image: "gorila.png", syllables: ["empieza por", "g"] },
        { word: "Galleta", image: "galleta.png", syllables: ["empieza por", "g"] },
        { word: "Guitarra", image: "guitarra.png", syllables: ["empieza por", "g"] }
    ],
    h: [
        { word: "Halc√≥n", image: "halcon.png", syllables: ["empieza por", "h"] },
        { word: "Hipop√≥tamo", image: "hipopotamo.png", syllables: ["empieza por", "h"] },
        { word: "Huevo", image: "huevo.png", syllables: ["empieza por", "h"] },
        { word: "Helado", image: "helado.png", syllables: ["empieza por", "h"] }
    ],
    i: [
        { word: "Iguana", image: "iguana.png", syllables: ["empieza por", "i"] },
        { word: "Insecto", image: "insecto.png", syllables: ["empieza por", "i"] },
        { word: "Impresora", image: "impresora.png", syllables: ["empieza por", "i"] },
        { word: "Isla", image: "isla.png", syllables: ["empieza por", "i"] }
    ],
    j: [
        { word: "Jirafa", image: "jirafa.png", syllables: ["empieza por", "j"] },
        { word: "Jabal√≠", image: "jabali.png", syllables: ["empieza por", "j"] },
        { word: "Jab√≥n", image: "jabon.png", syllables: ["empieza por", "j"] },
        { word: "Juguete", image: "juguete.png", syllables: ["empieza por", "j"] }
    ],
    k: [
        { word: "Koala", image: "koala.png", syllables: ["empieza por", "k"] },
        { word: "Kiwi", image: "kiwi.png", syllables: ["empieza por", "k"] },
        { word: "Karaoke", image: "karaoke.png", syllables: ["empieza por", "k"] },
        { word: "Ketchup", image: "ketchup.png", syllables: ["empieza por", "k"] }
    ],
    l: [
        { word: "Lobo", image: "lobo.png", syllables: ["empieza por", "l"] },
        { word: "Le√≥n", image: "leon.png", syllables: ["empieza por", "l"] },
        { word: "L√°piz", image: "lapiz.png", syllables: ["empieza por", "l"] },
        { word: "Luna", image: "luna.png", syllables: ["empieza por", "l"] }
    ],
    m: [
        { word: "Mono", image: "mono.png", syllables: ["empieza por", "m"] },
        { word: "Mariposa", image: "mariposa.png", syllables: ["empieza por", "m"] },
        { word: "Mam√°", image: "mama.png", syllables: ["empieza por", "m"] },
        { word: "Manzana", image: "manzana.png", syllables: ["empieza por", "m"] },
        { word: "Micr√≥fono", image: "microfono.png", syllables: ["empieza por", "m"] }
    ],
    n: [
        { word: "Nutria", image: "nutria.png", syllables: ["empieza por", "n"] },
        { word: "Nariz", image: "nariz.png", syllables: ["empieza por", "n"] },
        { word: "Naranja", image: "naranja.png", syllables: ["empieza por", "n"] },
        { word: "Nube", image: "nube.png", syllables: ["empieza por", "n"] }
    ],
    √±: [
        { word: "√ëand√∫", image: "√±andu.png", syllables: ["empieza por", "√±"] },
        { word: "√ëoqui", image: "√±oquis.png", syllables: ["empieza por", "√±"] },
        { word: "√ëame", image: "√±ame.png", syllables: ["empieza por", "√±"] }
    ],
    o: [
        { word: "Oso", image: "oso.png", syllables: ["empieza por", "o"] },
        { word: "Oveja", image: "oveja.png", syllables: ["empieza por", "o"] },
        { word: "Oreja", image: "oreja.png", syllables: ["empieza por", "o"] },
        { word: "Ojo", image: "ojo.png", syllables: ["empieza por", "o"] }
    ],
    p: [
        { word: "Pato", image: "pato.png", syllables: ["empieza por", "p"] },
        { word: "Ping√ºino", image: "pinguino.png", syllables: ["empieza por", "p"] },
        { word: "Pap√°", image: "papa.png", syllables: ["empieza por", "p"] },
        { word: "Pelota", image: "pelota.png", syllables: ["empieza por", "p"] }
    ],
    q: [
        { word: "Queso", image: "queso.png", syllables: ["empieza por", "q"] },
        { word: "Quince", image: "quince.png", syllables: ["Uno y cinco forman, el numero quince","y empieza por", "q"] },
        { word: "Quesadilla", image: "quesadilla.png", syllables: ["empieza por", "q"] },
        { word: "Quitamanchas", image: "quitamanchas.png", syllables: ["empieza por", "q"] }
    ],
    r: [
        { word: "Rana", image: "rana.png", syllables: ["empieza por", "r"] },
        { word: "Rat√≥n", image: "raton.png", syllables: ["empieza por", "r"] },
        { word: "Robot", image: "robot.png", syllables: ["empieza por", "r"] },
        { word: "Reloj", image: "reloj.png", syllables: ["empieza por", "r"] }
    ],
    s: [

        { word: "Serpiente", image: "serpiente.png", syllables: ["empieza por", "s"] },
        { word: "Sol", image: "sol.png", syllables: ["empieza por", "s"] },
        { word: "Silla", image: "silla.png", syllables: ["empieza por", "s"] },
        { word: "Sandia", image: "sandia.png", syllables: ["empieza por", "s"] }
    ],
    t: [
        { word: "Tigre", image: "tigre.png", syllables: ["empieza por", "t"] },
        { word: "Tuc√°n", image: "tucan.png", syllables: ["empieza por", "t"] },
        { word: "Tortuga", image: "tortuga.png", syllables: ["empieza por", "t"] },
        { word: "Tibur√≥n", image: "tiburon.png", syllables: ["empieza por", "t"] },
        { word: "Tijera", image: "tijera.png", syllables: ["empieza por", "t"] }
    ],
    u: [
        { word: "Urraca", image: "urraca.png", syllables: ["empieza por", "u"] },
        { word: "Unicornio", image: "unicornio.png", syllables: ["empieza por", "u"] },
        { word: "U√±a", image: "u√±a.png", syllables: ["empieza por", "u"] },
        { word: "Uva", image: "uva.png", syllables: ["empieza por", "u"] }
    ],
    v: [
        { word: "Vaca", image: "vaca.png", syllables: ["empieza por", "v"] },
        { word: "Vikingo", image: "vikingo.png", syllables: ["empieza por", "v"] },
        { word: "Vestido", image: "vestido.png", syllables: ["empieza por", "v"] },
        { word: "Viol√≠n", image: "violin.png", syllables: ["empieza por", "v"] }
    ],
    w: [
        { word: "Wombat", image: "wombat.png", syllables: ["empieza por", "w"] },
        { word: "Waffle", image: "waffle.png", syllables: ["empieza por", "w"] },
        { word: "Wifi", image: "wifi.png", syllables: ["empieza por", "w"] },
        { word: "Wok", image: "wok.png", syllables: ["empieza por", "w"] }
    ],
    x: [
        { word: "Xenartro", image: "xenartro.png", syllables: ["empieza por", "x"] },
        { word: "Xil√≥fono", image: "xilofono.png", syllables: ["empieza por", "x"] }
    ],
    y: [
        { word: "Yegua", image: "yegua.png", syllables: ["empieza por", "y"] },
        { word: "Yoyo", image: "yoyo.png", syllables: ["empieza por", "y"] },
        { word: "Yate", image: "yate.png", syllables: ["empieza por", "y"] },
        { word: "Yogur", image: "yogur.png", syllables: ["empieza por", "y"] }
    ],
    z: [
        { word: "Zorro", image: "zorro.png", syllables: ["empieza por", "z"] },
        { word: "Zorrillo", image: "zorrillo.png", syllables: ["empieza por", "z"] },
        { word: "Zapato", image: "zapato.png", syllables: ["empieza por", "z"] },
        { word: "Zumo", image: "zumo.png", syllables: ["empieza por", "z"] }
    ]
    
};

const numbers = {
    0: [{ word: "CERO", image: "cero.png", syllables: ["empieza por", "C"] }],
    1: [{ word: "Uno", image: "uno.png", syllables: ["empieza por", "U"] }],
    2: [{ word: "Dos", image: "dos.png", syllables: ["empieza por", "D"] }],
    3: [{ word: "Tres", image: "tres.png", syllables: ["empieza por", "T"] }],
    4: [{ word: "Cuatro", image: "cuatro.png", syllables: ["empieza por", "C"] }],
    5: [{ word: "Cinco", image: "cinco.png", syllables: ["empieza por", "C"] }],
    6: [{ word: "Seis", image: "seis.png", syllables: ["empieza por", "S"] }],
    7: [{ word: "Siete", image: "siete.png", syllables: ["empieza por", "S"] }],
    8: [{ word: "Ocho", image: "ocho.png", syllables: ["empieza por", "O"] }],
    9: [{ word: "Nueve", image: "nueve.png", syllables: ["empieza por", "N"] }],
    10: [{ word: "Diez", image: "diez.png", syllables: ["Uno y cero forman, el numero diez", "y empieza por", "D"] }]
};

const shapes = {
    "üü¢": [{ word: "C√≠rculo", image: "circulo.png", syllables: ["empieza por", "C"] }],
    "üî∫": [{ word: "Tri√°ngulo", image: "triangulo.png", syllables: ["empieza por", "T"] }],
    "üü®": [{ word: "Cuadrado", image: "cuadrado.png", syllables: ["empieza por", "C"] }],
    "üî∑": [{ word: "Rombo", image: "rombo.png", syllables: ["empieza por", "R"] }],
    "‚ùö": [{ word: "Rect√°ngulo", image: "rectangulo.png", syllables: ["empieza por", "R"] }],
    "‚¨°": [{ word: "Hex√°gono", image: "hexagono.png", syllables: ["empieza por", "H"] }],
    "‚≠ê": [{ word: "Estrella", image: "estrella.png", syllables: ["empieza por", "E"] }],
    "üåô": [{ word: "Media Luna", image: "medialuna.png", syllables: ["empieza por", "M"] }],
    "‚¨ü": [{ word: "Pent√°gono", image: "pentagono.png", syllables: ["empieza por", "P"] }],
    "‚¨≠": [{ word: "√ìvalo", image: "ovalo.png", syllables: ["empieza por", "O"] }],
    "‚ù§Ô∏è": [{ word: "Coraz√≥n", image: "corazon.png", syllables: ["empieza por", "C"]}]
};

let currentCategory = null;
let currentKey = null;
let currentWordIndex = 0;
let currentUtterance = null;

const keyboardModal = document.getElementById('keyboardModal');
const keyboardContainer = document.querySelector('.keyboard');
const modalTitle = document.getElementById('modalTitle');
const navButtons = document.getElementById('nav-buttons');
const viewDisplay = document.getElementById('app');

// Funci√≥n mejorada para mostrar el teclado
function generateKeyboard(categoryData) {
    keyboardContainer.innerHTML = '';
    Object.keys(categoryData).forEach(key => {
        const button = document.createElement('button');
        button.className = 'key';
        button.textContent = key.toUpperCase();
        button.addEventListener('click', () => {
            currentKey = key;
            currentWordIndex = 0;

            viewDisplay.classList.remove('hidden');
            updateDisplay();
            keyboardModal.style.display = 'none';
        });
        keyboardContainer.appendChild(button);
    });
}

// Funci√≥n mejorada para actualizar la visualizaci√≥n
function updateDisplay() {
    const categoryData = {letters, numbers, shapes}[currentCategory];
    const wordObj = categoryData[currentKey][currentWordIndex];
    
    // Actualizar display de letra/n√∫mero
    const letterDisplay = document.getElementById('letter-display');
    if (currentCategory === 'numbers') {
        letterDisplay.innerHTML = `<span class="text-9xl text-red-600 font-bold">${currentKey}</span>`;
    } else {
        letterDisplay.innerHTML = `
            <span class="text-8xl text-red-600 font-bold">${currentKey.toUpperCase()}</span>
            ${currentCategory === 'letters' ? `<span class="text-5xl text-blue-700 font-semibold">${currentKey.toLowerCase()}</span>` : ''}
        `;
    }
    
    // Actualizar palabra
    const firstLetter = wordObj.word[0];
    const middleLetters = wordObj.word.slice(1);
    
    document.getElementById('first-letter').textContent = firstLetter;
    document.getElementById('middle-letters').textContent = middleLetters;
    
    // Actualizar imagen
    const imageDisplay = document.getElementById('image-display');
    imageDisplay.src = 'img/' + wordObj.image;
    imageDisplay.classList.remove('hidden');
    letterDisplay.classList.remove('hidden');
    if (currentCategory === 'shapes') {
        imageDisplay.classList.add('hidden');
    }

    if (currentCategory === 'numbers') {
        letterDisplay.classList.add('hidden');
    }
    
    // Control de botones de navegaci√≥n
    navButtons.classList.toggle('hidden', categoryData[currentKey].length <= 1);
    
    // Texto para voz
    const speechText = currentCategory === 'numbers' 
        ? `${wordObj.word}: ${wordObj.syllables.join(' ')}`
        : `${wordObj.word} - ${wordObj.syllables.join(' ')}`;

    // Agregar el event listener para reproducir el audio al hacer clic
     imageDisplay.onclick = () => speak(speechText);

    
    speak(speechText);
}

// Funci√≥n de voz mejorada
/*function speak(text) {
    if (currentUtterance) {
        speechSynthesis.cancel();
    }
    currentUtterance = new SpeechSynthesisUtterance(text);
    currentUtterance.lang = 'es-ES';
    currentUtterance.rate = 0.5;
    speechSynthesis.speak(currentUtterance);
}*/



// Agrega este c√≥digo en la secci√≥n JavaScript

// Modificar el c√≥digo de voces
let voices = [];
const voiceSelect = document.getElementById('voiceSelect');

function loadVoices() {
voices = speechSynthesis.getVoices();
voiceSelect.innerHTML = '<option value="auto">Voz autom√°tica</option>';

// Filtrar solo voces en espa√±ol con alta prioridad
const spanishVoices = voices.filter(voice => {
return voice.lang === 'es-ES' || 
       voice.lang === 'es-MX' ||
       voice.lang === 'es-US' ||
       voice.lang === 'es-AR' ||
       voice.lang.startsWith('es-');
});

// Ordenar por calidad
const preferredVoices = spanishVoices.sort((a, b) => {
const qualityOrder = ['Google espa√±ol', 'Microsoft Helena', 'Microsoft Sabina', 'Microsoft Pablo'];
return qualityOrder.indexOf(b.name) - qualityOrder.indexOf(a.name);
});

preferredVoices.forEach((voice, index) => {
const option = document.createElement('option');
option.value = index;
option.textContent = `${voice.name} (${voice.lang.replace('_', '-')})`;
voiceSelect.appendChild(option);
});

// Si no hay voces en espa√±ol, mostrar advertencia
if (spanishVoices.length === 0) {
const option = document.createElement('option');
option.textContent = "No se encontraron voces en espa√±ol";
option.disabled = true;
voiceSelect.appendChild(option);
}
}

function speak(text) {
if (currentUtterance) {
speechSynthesis.cancel();
}

currentUtterance = new SpeechSynthesisUtterance(text);
currentUtterance.rate = 0.4;  // Velocidad ligeramente m√°s natural
currentUtterance.pitch = 1;   // Tono neutral

// Forzar siempre espa√±ol aunque la voz no lo especifique
currentUtterance.lang = 'es-ES';

// Configurar voz seleccionada si existe
const selectedVoice = voiceSelect.value;
if (selectedVoice !== 'auto' && voices[selectedVoice]) {
currentUtterance.voice = voices[selectedVoice];
currentUtterance.lang = voices[selectedVoice].lang;
}

// Configuraciones adicionales para mejor pronunciaci√≥n
currentUtterance.text = text
.replace(/¬ø/g, '')  // Remover signos de interrogaci√≥n iniciales
.replace(/¬°/g, '') // Remover signos de exclamaci√≥n iniciales
.replace(/:/g, '')  // Eliminar los dos puntos
.replace(/¬ø/g, '')  // Remover signos de interrogaci√≥n iniciales
.replace(/¬°/g, '')  // Remover signos de exclamaci√≥n iniciales
.replace(/\s+/g, ' ').trim(); 

speechSynthesis.speak(currentUtterance);
}

// Inicializaci√≥n mejorada de voces
if (speechSynthesis.onvoiceschanged !== undefined) {
speechSynthesis.onvoiceschanged = loadVoices;
}

// Cargar voces cada segundo hasta que se detecten (para m√≥viles)
const voiceCheckInterval = setInterval(() => {
if (speechSynthesis.getVoices().length > 0) {
loadVoices();
clearInterval(voiceCheckInterval);
}
}, 1000);

// Cargar inicialmente
loadVoices();



// Event Listeners mejorados
document.getElementById('lettersBtn').addEventListener('click', () => {
    currentCategory = 'letters';
    modalTitle.textContent = 'Selecciona una letra';
    generateKeyboard(letters);
    keyboardModal.style.display = 'flex';
});

document.getElementById('numbersBtn').addEventListener('click', () => {
    currentCategory = 'numbers';
    modalTitle.textContent = 'Selecciona un n√∫mero';
    generateKeyboard(numbers);
    keyboardModal.style.display = 'flex';
});

document.getElementById('shapesBtn').addEventListener('click', () => {
    currentCategory = 'shapes';
    modalTitle.textContent = 'Selecciona una forma';
    generateKeyboard(shapes);
    keyboardModal.style.display = 'flex';
});

document.getElementById('closeKeyboardBtn').addEventListener('click', () => {
    keyboardModal.style.display = 'none';
});

document.getElementById('prevWordBtn').addEventListener('click', () => {
    const categoryData = {letters, numbers, shapes}[currentCategory];
    currentWordIndex = (currentWordIndex - 1 + categoryData[currentKey].length) % categoryData[currentKey].length;
    updateDisplay();
});

document.getElementById('nextWordBtn').addEventListener('click', () => {
    const categoryData = {letters, numbers, shapes}[currentCategory];
    currentWordIndex = (currentWordIndex + 1) % categoryData[currentKey].length;
    updateDisplay();
});

// Cerrar modal al hacer click fuera
window.addEventListener('click', (e) => {
    if (e.target === keyboardModal) {
        keyboardModal.style.display = 'none';
    }
});
